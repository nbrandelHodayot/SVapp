{% extends "base_layout.html" %}

{% block content %}
<div id="context-holder" style="display:none;">{% block context_name %}{% endblock %}</div>

<div class="status-tabs-container">
    {% set ctx = self.context_name() | trim %}
    <button class="tab-btn {% if active_tab == 'boys' %}active{% endif %}" 
            onclick="handleButtonClick('TAB_BOYS', '/status_boys.html', '{{ ctx }}')">בנים</button>
    <button class="tab-btn {% if active_tab == 'girls' %}active{% endif %}" 
            onclick="handleButtonClick('TAB_GIRLS', '/status_girls.html', '{{ ctx }}')">בנות</button>
    <button class="tab-btn {% if active_tab == 'public' %}active{% endif %}" 
            onclick="handleButtonClick('TAB_PUBLIC', '/status_public.html', '{{ ctx }}')">ציבורי</button>
    <button class="tab-btn {% if active_tab == 'shabbat' %}active{% endif %}" 
            onclick="handleButtonClick('TAB_SHABBAT', '/status_shabbat.html', '{{ ctx }}')">שבת</button>
</div>

{# תוכן סטטוס - אם status_data מועבר מ-Flask, נציג אותו כאן #}
{% if status_data is defined %}
<div class="status-grid">
    {# הלולאה רצה על כל נורה שחזרה מהפונקציה fetch_plc_status #}
    {% for name, status in status_data.items() %}
    <div class="house-box">
        <div class="led-item">
            <span class="light-name">{{ name }}</span>
            <div class="light-indicator {{ status }}"></div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

{% block status_content %}{% endblock %}

<script>
    // פונקציית חזרה ייעודית שמשתמשת בהקשר
    async function syncAndNavigateBack(targetUrl) {
        const currentCtx = document.getElementById('context-holder').innerText.trim();
        const backCmd = "BACK_" + currentCtx;
        await window.sendAction(backCmd);
        setTimeout(() => { window.location.href = targetUrl; }, 600);
    }
</script>

<style>
    .status-tabs-container { 
        display: flex; 
        justify-content: space-around; 
        background: #f1f3f5; 
        padding: 15px; 
        border-bottom: 3px solid #dee2e6;
        gap: 10px;
    }
    .tab-btn { 
        flex: 1;
        padding: 12px; 
        border: 1px solid #ced4da; 
        background: white; 
        cursor: pointer; 
        font-weight: bold; 
        border-radius: 8px;
        transition: all 0.2s;
    }
    .tab-btn.active { 
        background: #007bff; 
        color: white; 
        border-color: #0056b3;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }


</style>
{% endblock %}