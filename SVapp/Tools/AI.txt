יש לי מערכת תואמת "בית חכם" עם בקר IDEC IZUMI Corporation עם הרישום Micro_I (Allegro RomPager 4.20)‎.
הבקר עובד בשיטת הדמיה של לחיצת עכבר והיא נקלט בשלושה מימדים X , Y מציינים נקודה על גריד ו N מציין שכבה. נתוני השכבות ותאור שלהם מרוכזים בקובץ CONTEXT_N.TXT.
אני מפתח אפליקציה לשליטה מרחוק (Web-to-Hardware) עבור מערכת זו.

כלל-על: תזכורת חשובה: האפליקציה נכתבת בשפה העברית והפריסה בה צריכה להיות תמיד מימין לשמאל.

מערכת זו מורכבת משרת FLASK הנכתב ב "פייתון" (pthon) ומערכת ווב הנכתבת באמצעות HTML, CSS ו JS.
הרעיון הוא שהאפליקציה תדמה את ממשק הווב של הבקר בצורה מושלמת: גם מבחינת מראה חיצוני וגם מבחינת מידע ופעולות.
במלים אחרות, המערכת מחקה את הבקר מבחינת תצוגה, כפתורי ניווט, כפתורי פעולה ואף נורות ביקורת.
המערכת מתווכת בין אפליקציית ווב לבין בקר שמקבל פקודות CGI המדמות לחיצות עכבר (remote_mouse.cgi).
כמו כן האפליקציה יודעת למשוך תמונה מהבקר בזמן אמת, לקרוא את צבע פיקסל (או קבוצת פיקסלים) בקואורדינטות מוגדרות מראש ולשלוח  המידע לתצוגה על הדף באפליקציה.

(את הדרך להורדת התמונה גיליתי אחרי שניסיתי לשמור בשם דף ממשק הווב של הבקר.
לדוגמא:
http://192.168.1.234/CF/CAPTURE/CapVGA.BMP?d=1767296055060
אחרי שימוש ב F12 כדי להשיג עליו מידע בלשונית network, ראיתי את הנתונים הבאים:
ב general:

Request URL: http://192.168.1.234/CF/CAPTURE/CapVGA.BMP?d=1767296055060
Request Method: GET
Status Code: 200 OK
Remote Address: 192.168.1.234:80
Referrer Policy: strict-origin-when-cross-origin

ב Response Headers:
content-type: image/jpeg
date: Tue, 08 Jun 1993 15:05:17 GMT
last-modified: Thu, 01 Jan 2026 21:33:33 GMT
server: Allegro-Software-RomPager/4.20
set-cookie: scr_sw = 01000110001000000000000000000; path=/

ב Request Headres:

accept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8
accept-encoding: gzip, deflate
accept-language: en-US,en;q=0.9,he;q=0.8
authorization: Basic RWxpOjY2OTEx
cache-control: no-cache
connection: keep-alive
cookie: img_type=/CF/CAPTURE/CapVGA.BMP; scr_sw=01000110001000000000000000000
host: 192.168.1.234
pragma: no-cache
referer: http://192.168.1.234/remote_control_full.html?pic_format=bmp
user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36
בעקבות הנתנוים האלה כתבתי את קובץ העזר plc_core.py)

מבנה הקבצים ותפקידם:

server_app.py (Flask Backend): הלב של המערכת. מנהל את ה-Session מול הבקר, מקבל בקשות מהממשק, ומתרגם אותן לקריאות HTTP לבקר.
config.py (Configuration): מכיל את מיפוי הקואורדינטות (X, Y) וה-Contexts (ערכי N) של כל מסכי הבקר. כולל הגדרות למקלדת הדינמית.

login.py (Automation): סקריפט מורכב המבצע רצף לחיצות אוטומטי לכניסה למערכת

Frontend (templates/ & static/): index.html & base_layout.html: תשתית ה-UI ודף הבית.

דפי "סטטוס מערכות" להצגת סטטוס אזורים באמצעות נורות ביקורת (אזורי בנים/בנות/ציבורי).:

status_boys.html
status_girls.html
status_public.html

דפי "בקרת אזורים" לשליטה באזורים השונים והפעלת מערכות ידנית ובאמצעות מנגנון מדמה שעון שבת".
control.htm


תובנות טכניות קריטיות (לא לשנות!):

תחביר ה-URL: הבקר דורש הפרדה בפסיקים ולא באמפרסנד. פורמט תקין: ?pos_x=X,pos_y=Y,n=N.

מקלדת דינמית: המקשים מחושבים מתמטית ב-login.py על בסיס KBD_START_X וקפיצות של KBD_STEP (40px).

ניהול זמן (Timing): הבקר איטי. נדרש DELAY של 1.2 שניות בין לחיצות רגילות, ו-2.5 שניות המתנה לאחר בחירת משתמש (DOWN_ARROW) כדי לאפשר למקלדת ה-OSD להיטען.

רצף כניסה: כדי להעיר את הבקר בצורה אמינה, משתמשים בלחיצה כפולה על USER_BUTTON בקואורדינטות (220,20).

מיקום קבצים ותיקיות מעדכ בקובץ tree.txt
        

# Headers שמחקים דפדפן כדי למנוע חסימות 404 מהבקר
BROWSER_HEADERS = {
    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36",
    "Referer": config.REFERER,
    "Accept": "image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8",
    "Connection": "keep-alive"
}

